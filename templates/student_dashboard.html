{% extends 'base.html' %}
{% block content %}

    <div class="container-fluid">

        <div class="row">
            <div class="col-sm-4 col-md-2 px-1 bg-light">
                <div class="py-2 sticky-top flex-grow-1">
                    <div class="nav flex-column nav-pills" id="v-pills-tab"
                         role="tablist" aria-orientation="vertical">
                        {% for grade in grades %}
                            {% set course_name = grade.course.name.split(' - ') %}
                            {% if loop.first %}
                                <a class="nav-link active"
                                   id="v-pills-home-tab"
                                   data-toggle="pill"
                                   href="#v-pills-{{ loop.index }}" role="tab"
                                   aria-controls="v-pills-{{ loop.index }}"
                                   aria-selected="true">{{ course_name[0] }}: {{ grade.grade }}</a>
                            {% else %}
                                <a class="nav-link" id="v-pills-profile-tab"
                                   data-toggle="pill"
                                   href="#v-pills-{{ loop.index }}" role="tab"
                                   aria-controls="v-pills-{{ loop.index }}"
                                   aria-selected="false">{{ course_name[0] }}: {{ grade.grade }}</a>
                            {% endif %}
                        {% endfor %}

                    </div>
                </div>
            </div>
            <div class="col">

                <div class="jumbotron text-center p-2 bg-light sticky-top">
                    <h3>{{ grades[0].user.name }}</h3>
                    <small>Data last
                        updated: {{ record.created_at|strftime }}</small>

                    {% if students|length > 1 %}

                        <div class="dropdown m-2">
                            <button class="btn btn-primary btn-sm dropdown-toggle"
                                    type="button"
                                    id="dropdownMenuButton"
                                    data-toggle="dropdown"
                                    aria-haspopup="true" aria-expanded="false">
                                Select Student
                            </button>
                            <div class="dropdown-menu dropdown-menu-lg-right scrollable-menu"
                                 aria-labelledby="dropdownMenuButton">
                                {% for student in students %}
                                    <a class="dropdown-item"
                                       href="{{ url_for('student_dashboard', user_id=student[0]) }}">{{ student[1] }}</a>
                                {% endfor %}
                            </div>
                        </div>

                    {% endif %}
                </div>


                <div class="tab-content" id="v-pills-tabContent">
                    {% for grade in grades %}
                        {% if loop.first %}
                            <div class="tab-pane fade show active"
                                 id="v-pills-{{ loop.index }}"
                                 role="tabpanel"
                                 aria-labelledby="v-pills-{{ loop.index }}">

                        {% else %}
                            <div class="tab-pane fade"
                                 id="v-pills-{{ loop.index }}"
                                 role="tabpanel"
                                 aria-labelledby="v-pills-{{ loop.index }}">
                        {% endif %}
                    <div class="card">
                        <div class="card-header">
                            <div class="row">
                                <div class="col-12"><h4 class="card-title">
                                    Letter Grade: {{ grade.grade }}
                                </h4></div>

                            </div>
                        </div>

                        <div class="card-body">
                            <button href="#"
                                    class="btn btn-secondary dropdown-toggle"
                                    data-toggle="collapse"
                                    data-target="#collapseExample-{{ loop.index }}"
                                    aria-expanded="false"
                                    aria-controls="collapseExample-{{ loop.index }}">
                                Explanation
                                of
                                Grades
                            </button>
                        </div>
                        <div class="collapse"
                             id="collapseExample-{{ loop.index }}">
                            <div class="card-body p-3">
                                <p>The following table is how your outcome
                                    Averages are converted into a Letter Grade.
                                </p>
                                <p class="font-weight-light">
                                    Please note that both Criteria 1 and 2 must
                                    be met to earn that letter Grade.
                                </p>
                                <table class="table table-bordered table-sm grade-table">
                                    <thead class="text-center align-text-top">
                                    <tr>
                                        <th>Letter Grade</th>
                                        <th>
                                            Criteria 1 <br>
                                            <div class="font-weight-light">75%
                                                of Outcome Averages Equal to or
                                                Above:
                                            </div>
                                        </th>
                                        <th>
                                            Criteria 2 <br>
                                            <div class="font-weight-light">No
                                                Outcome Average Below:
                                            </div>
                                        </th>
                                    </tr>
                                    </thead>
                                    <tbody class="text-center">
                                    {% for level in calculation_dict %}
                                        {% if level.grade == grade.grade %}
                                            <tr class="table-success">
                                                {% else %}
                                            <tr>
                                        {% endif %}
                                    <td>{{ level.grade }}</td>
                                    <td>{{ level.threshold }}</td>
                                    <td>{{ level.min_score }}</td>
                                    </tr>
                                    {% endfor %}
                                    <tr class="your-results">
                                        <th>Your results</th>
                                        <td>
                                            <strong>{{ grade.threshold }}</strong>
                                        </td>
                                        <td>
                                            <strong>{{ grade.min_score }}</strong>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="card mt-3">
                        <div class="card-header"><h4>Outcome
                            Averages</h4></div>
                        <div class="card-body">
                            <div>
                                <table class="table">
                                    <thead>
                                    <tr class="d-flex">
                                        <th class="col-8">Outcome</th>
                                        <th class="text-center col-4">Outcome
                                            Average
                                        </th>
                                    </tr>
                                    </thead>

                                    <tbody>
                                    {% for outcome_average in grade.outcomes %}
                                        <tr class="d-flex">
                                            {# Use display name if it's available #}
                                            {% if outcome_average.display_name %}
                                                <td scope="row" class="col-8">
                                                    {{ outcome_average.display_name }}
                                                </td>
                                            {% else %}
                                                <td scope="row" class="col-8">
                                                    {{ outcome_average.title }}
                                                </td>
                                            {% endif %}
                                            {#                                     Only display the outcome_avg if outcome's have been assessed.#}
                                            {% if outcome_average.outcome_avg > 0 %}
                                                <td class="text-center col-4">
                                                    {{ outcome_average.outcome_avg }}
                                                </td>
                                            {% endif %}
                                        </tr>
                                    {% endfor %}
                                    </tbody>

                                </table>
                            </div>
                        </div>
                    </div>

                    </div>
                    {% endfor %}
                    </div>
                </div>
            </div>


        </div>
    </div>


{% endblock %}