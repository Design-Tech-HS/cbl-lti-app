{% extends 'base.html' %}
{% block content %}
    <div class="container">
        <h2>dTech Student Outcome Summary</h2>
        <p>Data last updated: {{ record.created_at|strftime }}</p>
        {% if students|length > 1 %}
            <div class="form-group">
                <label for="sel">Current Student</label>
                <select class="form-control" id="sel"
                        onchange="showHide()">
                    {% for student in students %}
                        <option value="{{ loop.index }}">{{ student[0].user.name }}</option>
                    {% endfor %}
                </select>
            </div>
        {% else %}
{#  Get the single students name   #}
            <h3>{{ students[0][0].user.name }}</h3>
        {% endif %}
{# Hide the all but the first students records #}
        {% for student in students %}
            {% set student_number = loop.index %}
            {% if loop.index == 1 %}
                <div id="accordion{{ loop.index }}" class="student"
                     style="display: block">
            {% else %}
                <div id="accordion{{ loop.index }}" class="student"
                     style="display: none">
            {% endif %}
        {% for grade in student %}
            <div class="card">
                <a class="card-link" data-toggle="collapse"
                   href="#collapse{{ loop.index }}">
                    <div class="card-header">

                        {% set course_name = grade.course.name.split(' - ') %}
                        {{ course_name[0] }}: {{ grade.grade }}

                    </div>
                </a>

                <div id="collapse{{ loop.index }}"
                     class="collapse hide"
                     data-parent="#accordion{{ student_number }}">

                    <div class="card-body">
                        Your grade is: {{ grade.grade }} because:
                        <ul>
                            <li><strong>75%</strong>
                                of your
                                Outcome Averages were above
                                a <strong>{{ grade.threshold }}</strong></li>
                            <li>Your
                                Lowest
                                Outcome
                                Average was above
                                a <strong>{{ grade.min_score }}</strong></li>
                        </ul>

                        <table class="table">
                            <thead>
                            <tr>
                                <th scope="col">Outcome</th>
                                <th scope="col">Score</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for outcome_average in grade.outcomes %}
                                <tr>
{# Use display name if it's available #}
                                    {% if outcome_average.display_name %}
                                        <td scope="row">{{ outcome_average.display_name }}</td>
                                    {% else %}
                                        <td scope="row">{{ outcome_average.title }}</td>
                                    {% endif %}
{#                                     Only display the outcome_avg if outcome's have been assessed.#}
                                    {% if outcome_average.outcome_avg > 0 %}
                                        <td>{{ outcome_average.outcome_avg }}</td>
                                    {% endif %}
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>

                    </div>
                </div>
            </div>
        {% endfor %}
        </div>
        {% endfor %}
        </div>
    </div>


{% endblock %}